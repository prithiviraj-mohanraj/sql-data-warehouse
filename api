validation/
├── input/
│   └── migration_scope.csv
├── scripts/
│   ├── 01_extract_scope.sh
│   ├── 02_check_tables_single_session.sh
│   ├── 03_extract_columns_single_session.sh
│   ├── 04_column_counts.sh
│   └── run_all.sh
├── output/
└── logs/


INPUT FILE
input/migration_scope.csv
Copy code

schema_name,table_name,column_name
sales,orders,order_id
sales,orders,amount
sales,returns,return_id
finance,txn,txn_id
finance,txn,amount

STEP 1 — Extract Schemas & Tables From CSV
✔ No database connection
✔ Produces summary file
scripts/01_extract_scope.sh
Bash
Copy code
#!/bin/bash

INPUT="../input/migration_scope.csv"
OUT="../output/scope_summary.csv"

mkdir -p ../output ../logs

echo "schema,table" > $OUT

awk -F',' 'NR>1 {print $1","$2}' $INPUT | sort -u >> $OUT

# Count schemas & tables
SCHEMA_COUNT=$(cut -d',' -f1 $OUT | tail -n +2 | sort -u | wc -l)
TABLE_COUNT=$(tail -n +2 $OUT | wc -l)

echo "Total Schemas: $SCHEMA_COUNT"
echo "Total Tables: $TABLE_COUNT"


STEP 2 — Check Table Presence (ONE CONNECTION)
✔ Only CSV tables checked
✔ No full schema listing
scripts/02_check_tables_single_session.sh

#!/bin/bash

SCOPE="../output/scope_summary.csv"
SQL_FILE="../logs/check_tables.sql"
RAW_OUT="../logs/check_tables_raw.txt"
OUT="../output/table_presence.csv"

echo "schema,table,exists_in_hive" > $OUT
> $SQL_FILE

# Generate SQL (single session)
tail -n +2 $SCOPE | while IFS=',' read SCHEMA TABLE
do
    echo "SHOW TABLES IN $SCHEMA LIKE '$TABLE';" >> $SQL_FILE
done

# Run once
impala-shell -k -i your-host -f $SQL_FILE -B > $RAW_OUT

# Parse results
INDEX=0
tail -n +2 $SCOPE | while IFS=',' read SCHEMA TABLE
do
    RESULT=$(sed -n "$((INDEX+1))p" $RAW_OUT | grep -w "$TABLE" || true)

    if [ -z "$RESULT" ]; then
        echo "$SCHEMA,$TABLE,NO" >> $OUT
    else
        echo "$SCHEMA,$TABLE,YES" >> $OUT
    fi

    ((INDEX++))
done

echo "Table presence file → $OUT"


STEP 3 — Extract Columns & Datatypes (ONE CONNECTION)
✔ DESCRIBE all tables in one session
✔ Produces one clean file
scripts/03_extract_columns_single_session.sh

#!/bin/bash

SCOPE="../output/scope_summary.csv"
SQL_FILE="../logs/describe_tables.sql"
RAW_OUT="../logs/describe_raw.txt"
OUT="../output/table_columns.csv"

echo "schema,table,column,data_type" > $OUT
> $SQL_FILE

# Generate SQL
tail -n +2 $SCOPE | while IFS=',' read SCHEMA TABLE
do
    echo "DESCRIBE $SCHEMA.$TABLE;" >> $SQL_FILE
done

# Run once
impala-shell -k -i your-host -f $SQL_FILE -B > $RAW_OUT

# Parse output
CURRENT_SCHEMA=""
CURRENT_TABLE=""

tail -n +2 $SCOPE | while IFS=',' read SCHEMA TABLE
do
    CURRENT_SCHEMA=$SCHEMA
    CURRENT_TABLE=$TABLE

    # Extract DESCRIBE block for this table
    awk -v s="$SCHEMA" -v t="$TABLE" '
    NF>=2 && $1 != "#" {
        print s","t","$1","$2
    }' $RAW_OUT >> $OUT

done

echo "Column inventory → $OUT"

STEP 4 — Column Counts (No DB Connection)
scripts/04_column_counts.sh

#!/bin/bash

COL_FILE="../output/table_columns.csv"
OUT="../output/column_counts.csv"

echo "schema,table,column_count" > $OUT

tail -n +2 $COL_FILE | cut -d',' -f1,2 | sort | uniq -c | \
awk '{print $2","$3","$1}' >> $OUT

echo "Column counts file → $OUT"


